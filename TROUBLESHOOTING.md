# Решение проблем с ботом

## Бот не отвечает на команды

### Проверка 1: Запущен ли бот?

```bash
ps aux | grep "node index.js" | grep -v grep
```

Если команда ничего не выводит - бот не запущен.

**Решение:** Запустите бота:
```bash
cd "/путь/к/проекту/creativity-bot"
npm start
```

### Проверка 2: Есть ли ошибки в логах?

Если бот запущен в фоне, проверьте логи:
```bash
# Если бот запущен через systemd
sudo journalctl -u creativity-bot -n 50

# Если бот запущен через screen/tmux
# Подключитесь к сессии и посмотрите вывод
```

### Проверка 3: Правильно ли настроен .env файл?

Убедитесь, что файл `.env` содержит корректный токен бота:
```bash
cat .env | grep BOT_TOKEN
```

Токен должен быть в формате: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

## Бот падает при запуске

### Ошибка: "query is too old and response timeout expired"

**Причина:** Накопились устаревшие callback-запросы (нажатия на кнопки)

**Решение:** Эта проблема исправлена в версии 1.2.1. Обновите код:
```bash
git pull origin main
npm start
```

### Ошибка: "ECONNREFUSED" или "ETIMEDOUT"

**Причина:** Проблемы с сетевым подключением к Telegram API

**Решение:**
1. Проверьте интернет-соединение
2. Проверьте, не блокирует ли файрвол подключение к api.telegram.org
3. Попробуйте перезапустить бота через несколько минут

### Ошибка: "Cannot find module"

**Причина:** Не установлены зависимости

**Решение:**
```bash
npm install
npm start
```

## Бот не отправляет утренние сообщения

### Проверка 1: Работает ли планировщик?

В логах при запуске должна быть строка:
```
[CRON] Планировщик запущен (timezone: Europe/Moscow)
```

### Проверка 2: Правильная ли временная зона?

Проверьте настройку `TZ` в `.env` файле:
```bash
cat .env | grep TZ
```

Должно быть: `TZ=Europe/Moscow` (или ваша временная зона)

### Проверка 3: Запущен ли бот круглосуточно?

Бот должен работать постоянно, чтобы отправлять утренние сообщения. Используйте:
- systemd (Linux)
- pm2 (Node.js process manager)
- screen/tmux (простое решение)

## Кнопки не работают

### Проблема: "Это сообщение устарело"

**Причина:** Сообщение с кнопками было отправлено более 48 часов назад

**Решение:** Используйте команду `/start` для получения нового вопроса с актуальными кнопками

### Проблема: Кнопка не реагирует

**Причина:** Возможно, бот перезапускался и потерял контекст

**Решение:** 
1. Используйте `/start` для получения нового вопроса
2. Если проблема повторяется, проверьте логи бота

## База данных повреждена

### Симптомы:
- Ошибки "SQLITE_CORRUPT"
- Бот не сохраняет прогресс
- Статистика не обновляется

### Решение:

**Вариант 1: Восстановление из бэкапа**
```bash
cd scripts
./restore-db.sh /путь/к/бэкапу/database.db.backup
```

**Вариант 2: Пересоздание базы данных (потеря данных!)**
```bash
# Создайте бэкап на всякий случай
cp database.db database.db.old

# Удалите поврежденную базу
rm database.db

# Перезапустите бота - база будет создана заново
npm start
```

## Веб-панель не открывается

### Проверка 1: Включена ли панель?

В `.env` файле должно быть:
```
ENABLE_DASHBOARD=true
```

### Проверка 2: Правильный ли порт?

По умолчанию панель доступна на `http://localhost:3000`

Проверьте, не занят ли порт:
```bash
lsof -i :3000
```

Если порт занят, измените его в `.env`:
```
DASHBOARD_PORT=3001
```

## Получение помощи

Если проблема не решается:

1. Проверьте логи бота на наличие ошибок
2. Убедитесь, что используете последнюю версию кода
3. Создайте issue в репозитории с описанием проблемы и логами
4. Напишите автору: @kudinow

## Полезные команды

```bash
# Проверить статус бота
ps aux | grep "node index.js"

# Остановить бота
pkill -f "node index.js"

# Запустить бота
npm start

# Запустить бота в фоне (screen)
screen -S bot
npm start
# Нажмите Ctrl+A, затем D для отсоединения

# Вернуться к боту в screen
screen -r bot

# Просмотр логов в реальном времени (если используется systemd)
sudo journalctl -u creativity-bot -f

# Создать бэкап базы данных
cd scripts
./backup-db.sh

# Проверить версию Node.js
node --version  # Должна быть >= 14.0.0
```


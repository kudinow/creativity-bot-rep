# Telegram-бот для развития креативности

Простой Telegram-бот для ежедневной тренировки креативного мышления. Бот отправляет вопрос каждый день в 10:00 и принимает 10 ответов от пользователя.

## Описание

Тренажёр креативности помогает развивать гибкость мышления через простое ежедневное упражнение. Каждый день бот присылает новый вопрос, на который нужно придумать 10 вариантов ответа. Не важно, насколько необычными или странными будут ваши ответы — важно количество идей.

## Функциональность

- **Ежедневные вопросы** — в 10:00 (МСК) бот присылает случайный креативный вопрос
- **Приём ответов** — можно отправлять ответы по одному или списком (каждая строка = один ответ)
- **Подсчёт ответов** — бот автоматически считает количество ответов
- **Статистика** — отслеживание выполненных и пропущенных дней
- **Автоматическое закрытие дня** — в 23:59 (МСК) день закрывается, пропуски учитываются

## Установка

### Локальный запуск

1. Клонируйте или скачайте проект
2. Установите зависимости:

```bash
npm install
```

3. Создайте файл `.env` на основе `env.example`:

```bash
cp env.example .env
```

4. Получите токен бота от [@BotFather](https://t.me/BotFather):
   - Отправьте команду `/newbot`
   - Следуйте инструкциям для создания бота
   - Скопируйте полученный токен

5. Откройте `.env` и вставьте ваш токен:

```
BOT_TOKEN=ваш_реальный_токен
TIMEZONE=Europe/Moscow
```

### Запуск локально

```bash
npm start
```

или

```bash
node index.js
```

Бот запустится и начнёт работу. В консоли появятся сообщения о инициализации базы данных и планировщика.

### Запуск через Docker (локально)

Если у вас установлен Docker:

```bash
# Сборка образа
docker build -t creativity-bot .

# Запуск через Docker Compose
docker compose up -d

# Просмотр логов
docker compose logs -f
```

---

## Деплой в облако (Production)

Для круглосуточной работы бота развертывайте его в облаке. Подробная инструкция в [DEPLOY.md](./DEPLOY.md).

### Быстрый старт для Яндекс Облака

1. **Создайте виртуальную машину** в Яндекс Облаке
2. **Установите Docker** на сервере
3. **Загрузите проект** через Git
4. **Настройте** переменные окружения
5. **Запустите** бота

Полная пошаговая инструкция в файле [DEPLOY.md](./DEPLOY.md).

---

## Управление ботом на сервере

После развертывания в облаке используйте эти команды для управления:

### Подключение к серверу

```bash
ssh ubuntu@ВАШ_IP_АДРЕС
cd ~/creativity-bot-rep
```

### Запуск бота

```bash
docker compose up -d
```

Флаг `-d` запускает бота в фоновом режиме (detached mode).

### Остановка бота

```bash
docker compose down
```

Это остановит и удалит контейнер (база данных сохранится).

### Перезапуск бота

```bash
docker compose restart
```

Или полный перезапуск:

```bash
docker compose down
docker compose up -d
```

### Просмотр логов

```bash
# Все логи
docker compose logs

# Последние 100 строк
docker compose logs --tail=100

# Следить за логами в реальном времени
docker compose logs -f
```

Для выхода из режима слежения нажмите `Ctrl + C`.

### Проверка статуса

```bash
docker compose ps
```

Показывает состояние контейнеров (Running/Stopped).

---

## Обновление кода бота

Когда вы внесли изменения в код и хотите обновить бота на сервере:

### Шаг 1: Загрузите изменения на GitHub (с вашего Mac)

```bash
cd /путь/к/проекту/creativity-bot
git add .
git commit -m "Описание изменений"
git push origin main
```

### Шаг 2: Обновите код на сервере

Подключитесь к серверу и выполните:

```bash
ssh ubuntu@ВАШ_IP_АДРЕС
cd ~/creativity-bot-rep
git pull origin main
```

### Шаг 3: Перезапустите бота

```bash
docker compose down
docker compose up -d
```

### Шаг 4: Проверьте, что всё работает

```bash
docker compose logs -f
```

Должны увидеть:
```
[БОТ] Инициализация...
[БД] Таблицы успешно созданы
[CRON] Планировщик запущен
[БОТ] Бот запущен и готов к работе
```

---

## Редактирование вопросов

Чтобы изменить или добавить вопросы:

1. **Локально** откройте файл `data/questions.js`
2. Отредактируйте массив вопросов
3. Сохраните изменения
4. Загрузите на GitHub (см. "Обновление кода бота")
5. Обновите код на сервере и перезапустите бота

---

## Резервное копирование

База данных хранится в `data/database.db`. Для создания резервной копии:

```bash
# На сервере
docker compose exec creativity-bot cp /app/data/database.db /app/data/database.backup.db
```

Или скачайте базу на локальный компьютер:

```bash
# На вашем Mac
scp ubuntu@ВАШ_IP_АДРЕС:~/creativity-bot-rep/data/database.db ./database.backup.db
```

## Команды бота

- `/start` — Начать работу с ботом и получить вопрос дня
- `/stats` — Посмотреть статистику (выполненные/пропущенные дни)

## Как использовать

1. Запустите бота командой `/start`
2. Получите вопрос дня
3. Отправьте 10 ответов:
   - Можно по одному сообщению
   - Можно списком (каждый ответ с новой строки)
   - Можно комбинировать способы
4. Когда наберётся 10 ответов, бот сообщит о завершении
5. На следующий день в 10:00 получите новый вопрос

## Примеры ответов

**Вопрос:** "Что можно сделать со скрепкой?"

**Варианты отправки:**

Способ 1 (списком):
```
Сделать закладку
Почистить под ногтями
Открыть замок
Сделать украшение
...
```

Способ 2 (по одному):
```
Сделать закладку
```
```
Почистить под ногтями
```

## Технические детали

- **Node.js** — среда выполнения
- **node-telegram-bot-api** — работа с Telegram API
- **better-sqlite3** — хранение данных
- **node-cron** — планирование задач
- **dotenv** — управление конфигурацией

## Структура проекта

```
creativity-bot/
├── index.js          # Главный файл бота
├── database.js       # Работа с базой данных
├── scheduler.js      # Планировщик задач (cron)
├── data/
│   └── questions.js  # Массив вопросов
├── database.db       # SQLite база (создаётся автоматически)
├── package.json      # Зависимости
├── env.example       # Шаблон конфигурации
└── README.md         # Документация
```

## База данных

Автоматически создаются 3 таблицы:

- `users` — информация о пользователях
- `questions` — список вопросов
- `daily_progress` — прогресс выполнения заданий

База данных SQLite хранится в файле `database.db` (локально) или в `data/database.db` (в Docker).

## Файлы проекта

- `Dockerfile` — образ для контейнеризации
- `docker-compose.yml` — конфигурация для Docker Compose
- `.dockerignore` — исключения при сборке образа
- `.gitignore` — исключения для Git
- `DEPLOY.md` — подробная инструкция по деплою в облако

## Важно

- Ответы не сохраняются (только их количество)
- Нет проверки уникальности или качества ответов
- Напоминаний не предусмотрено
- Вопросы выбираются случайно из базы
- Для круглосуточной работы требуется деплой в облако (см. DEPLOY.md)
